<div class="map-page">
  <app-navbar></app-navbar>

  <!-- Search Header -->
  <div class="search-header" *ngIf="!isViewingSpot">
    <div class="container">
      <div class="search-card">
        <div class="search-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
        </div>
        <input type="text" [(ngModel)]="searchQuery" placeholder="Search for a location..." class="search-input"
          (keyup.enter)="searchLocation()">
        <button class="search-btn" (click)="searchLocation()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Map Container -->
  <div class="map-wrapper">
    <div #map class="map-container"></div>

    <!-- Location Status Overlay -->
    <div class="location-status-overlay" *ngIf="locationStatusMessage">
      <div class="status-box">
        <span>{{ locationStatusMessage }}</span>
      </div>
    </div>



    <!-- Floating Status Card for Journey -->
    <div class="status-card" *ngIf="isViewingSpot && isJourneyStarted">
      <div class="status-indicator">
        <div class="pulse-dot"></div>
        <span>Live Tracking</span>
      </div>
      <div class="status-distance">
        <span class="distance-number">{{ distance.toFixed(1) }}</span>
        <span class="distance-unit">km</span>
      </div>
    </div>
  </div>

  <!-- Location Selection Footer -->
  <div class="selection-footer" *ngIf="!isViewingSpot">
    <div class="container">
      <div class="selection-card">
        <div class="location-preview">
          <div class="location-icon">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
              <circle cx="12" cy="10" r="3"></circle>
            </svg>
          </div>
          <div class="location-text">
            <span class="location-label">Selected Location</span>
            <span class="location-name">{{ selectedLocation.name }}</span>
          </div>
        </div>
        <div class="action-buttons">
          <button class="btn btn-ghost" (click)="cancel()">Cancel</button>
          <button class="btn btn-primary" (click)="confirmLocation()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20,6 9,17 4,12"></polyline>
            </svg>
            Confirm
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Journey Control Footer -->
  <div class="journey-footer" *ngIf="isViewingSpot && currentLocation">
    <div class="container">
      <div class="journey-card">
        <!-- Journey Header -->
        <div class="journey-header">
          <div class="distance-display">
            <div class="distance-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 11a3 3 0 1 0 6 0a3 3 0 0 0-6 0"></path>
                <path d="M17.657 16.657l-4.243 4.243a2 2 0 0 1-2.827 0l-4.244-4.243a8 8 0 1 1 11.314 0z"></path>
              </svg>
            </div>
            <div class="distance-info">
              <span class="distance-label">Distance</span>
              <span class="distance-value">{{ distance.toFixed(2) }} km</span>
            </div>
          </div>

          <button class="journey-btn" [class.journey-btn--active]="isJourneyStarted" (click)="toggleJourney()">
            <div class="btn-icon">
              <svg *ngIf="!isJourneyStarted" width="14" height="14" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2.5">
                <polygon points="5,3 19,12 5,21 5,3"></polygon>
              </svg>
              <svg *ngIf="isJourneyStarted" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2.5">
                <rect x="6" y="4" width="4" height="16"></rect>
                <rect x="14" y="4" width="4" height="16"></rect>
              </svg>
            </div>
            <span>{{ isJourneyStarted ? 'End' : 'Start' }}</span>
          </button>
        </div>

        <!-- Route Information -->
        <div class="route-display">
          <div class="route-point route-point--from">
            <div class="point-marker"></div>
            <div class="point-info">
              <span class="point-label">{{ isJourneyStarted ? 'Current Location' : 'Starting Point' }}</span>
              <span class="point-name">{{ currentLocationName }}</span>
            </div>
          </div>

          <div class="route-connector">
            <div class="connector-line"></div>
            <div class="connector-dots">
              <span></span><span></span><span></span>
            </div>
          </div>

          <div class="route-point route-point--to">
            <div class="point-marker"></div>
            <div class="point-info">
              <span class="point-label">Destination</span>
              <span class="point-name">{{ selectedLocation.name }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>