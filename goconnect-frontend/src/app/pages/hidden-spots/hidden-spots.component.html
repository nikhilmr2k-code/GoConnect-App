<app-navbar activeRoute="hidden-spots"></app-navbar>

<div class="hidden-spots-container main-content">
  <div class="spots-header">
    <h1>Hidden Spots</h1>
    <p>Discover and share amazing hidden locations</p>
  </div>

  <!-- Tab Navigation -->
  <div class="tab-navigation">
    <button class="tab-btn" [class.active]="activeTab === 'discover'" (click)="activeTab = 'discover'">
      Discover Spots
    </button>
    <button class="tab-btn" [class.active]="activeTab === 'discussed'"
      (click)="activeTab = 'discussed'; loadDiscussedHiddenSpots()">
      Discussed Hidden Spots
    </button>
    <button class="tab-btn" [class.active]="activeTab === 'add'" (click)="activeTab = 'add'">
      Add New Spot
    </button>
  </div>

  <!-- Discover Spots Tab -->
  <div *ngIf="activeTab === 'discover'" class="tab-content">
    <div class="search-section">
      <div class="search-container">
        <input type="text" [(ngModel)]="searchQuery" placeholder="Search spots by name, location, or coordinates..."
          class="search-input" (keyup.enter)="searchSpots()" (input)="searchSpots()">
        <button class="search-btn" (click)="searchSpots()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
        </button>
      </div>
    </div>

    <div class="spots-grid">
      <div *ngFor="let spot of spots" class="spot-card" (click)="viewSpotOnMap(spot)">
        <div class="spot-image">
          <div class="spot-placeholder">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
              <circle cx="12" cy="10" r="3"></circle>
            </svg>
          </div>
        </div>
        <div class="spot-content">
          <h3>{{ spot.name }}</h3>
          <div class="spot-location">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
              <circle cx="12" cy="10" r="3"></circle>
            </svg>
            <span>{{ spot.locationAddress || 'Location not specified' }}</span>
          </div>
          <p class="spot-description">{{ spot.locationDescription }}</p>
          <div class="spot-rating" *ngIf="spot.rating">
            <div class="stars">
              <svg *ngFor="let star of [1,2,3,4,5]; let i = index" width="16" height="16" viewBox="0 0 24 24"
                [attr.fill]="i < spot.rating ? '#f59e0b' : 'none'" stroke="#f59e0b" stroke-width="2">
                <polygon
                  points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26">
                </polygon>
              </svg>
            </div>
            <span class="rating-value">{{ spot.rating }}/5</span>
          </div>
        </div>
      </div>

      <div *ngIf="spots.length === 0" class="empty-state">
        <div class="empty-icon">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
            <circle cx="12" cy="10" r="3"></circle>
          </svg>
        </div>
        <h3>No hidden spots found</h3>
        <p>Be the first to discover and share amazing locations!</p>
        <button class="btn btn-primary" (click)="activeTab = 'add'">Add First Spot</button>
      </div>
    </div>
  </div>

  <!-- Discussed Hidden Spots Tab -->
  <div *ngIf="activeTab === 'discussed'" class="tab-content">
    <div class="section-header">
      <h2>Discussed Hidden Spots</h2>
      <p>Hidden spots that have been discussed in forums</p>
      <button class="btn btn-secondary" (click)="loadDiscussedHiddenSpots()">Refresh</button>
    </div>

    <div class="discussed-spots-grid">
      <div *ngFor="let forum of discussedSpots" class="discussed-spot-card">
        <div class="forum-info">
          <h3>{{ forum.name }}</h3>
          <div class="forum-details">
            <div class="forum-author">
              <strong>By:</strong> {{ forum.userInfo.name }}
            </div>
            <div class="forum-visibility" [class.public]="forum.visibility === 'public'"
              [class.private]="forum.visibility === 'private'">
              {{ forum.visibility }}
            </div>
          </div>
          <p class="forum-description">{{ forum.description || 'No description available' }}</p>
        </div>

        <div class="location-info">
          <div class="location-item" *ngIf="forum.location">
            <strong>General Location:</strong> {{ forum.location }}
          </div>
          <div class="location-item" *ngIf="forum.pinLocation">
            <strong>Pin Location:</strong> {{ forum.pinLocation }}
          </div>
          <div class="forum-hashtags" *ngIf="forum.hashtag">
            <span class="hashtag">#{{ forum.hashtag }}</span>
          </div>
        </div>

        <div class="forum-actions">
          <button class="btn btn-outline btn-sm">View Forum</button>
          <button class="btn btn-primary btn-sm" (click)="viewDiscussedSpotOnMap(forum)">View on Map</button>
        </div>
      </div>

      <div *ngIf="discussedSpots.length === 0" class="empty-state">
        <div class="empty-icon">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
            <circle cx="12" cy="10" r="3"></circle>
          </svg>
        </div>
        <h3>No Discussed Hidden Spots</h3>
        <p>No forums have discussed specific hidden spot locations yet.</p>
      </div>
    </div>
  </div>

  <!-- Add New Spot Tab -->
  <div *ngIf="activeTab === 'add'" class="tab-content">
    <div class="add-spot-container">
      <div class="add-spot-header">
        <h2>Add New Hidden Spot</h2>
        <p>Share your secret location with the community</p>
      </div>

      <form (ngSubmit)="saveHiddenSpot()" class="add-spot-form">
        <div class="form-grid">
          <div class="form-group full-width">
            <label class="form-label">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
              </svg>
              Spot Name
              <span class="required">*</span>
            </label>
            <input type="text" [(ngModel)]="newSpot.name" name="name" class="form-control"
              placeholder="Enter a captivating name for this spot" required>
          </div>

          <div class="form-group full-width">
            <label class="form-label">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14,2 14,8 20,8"></polyline>
                <line x1="16" y1="13" x2="8" y2="13"></line>
                <line x1="16" y1="17" x2="8" y2="17"></line>
                <polyline points="10,9 9,9 8,9"></polyline>
              </svg>
              Description
            </label>
            <textarea [(ngModel)]="newSpot.locationDescription" name="description" class="form-control"
              placeholder="Describe what makes this spot special..." rows="4"></textarea>
          </div>

          <div class="form-group">
            <label class="form-label">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
              </svg>
              Location
            </label>
            <input type="text" [(ngModel)]="newSpot.locationAddress" name="address" class="form-control" readonly
              placeholder="Select location from map">
            <button type="button" class="btn btn-outline mt-2" (click)="openMapSelector()">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2"></polygon>
                <line x1="8" y1="2" x2="8" y2="18"></line>
                <line x1="16" y1="6" x2="16" y2="22"></line>
              </svg>
              Select on Map
            </button>
          </div>

          <div class="form-group">
            <label class="form-label">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polygon
                  points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26">
                </polygon>
              </svg>
              Rating
            </label>
            <input type="number" [(ngModel)]="newSpot.rating" name="rating" class="form-control" min="1" max="5"
              step="0.1" placeholder="Rate from 1-5">
          </div>

          <div class="form-group full-width">
            <label class="form-label">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                <polyline points="21,15 16,10 5,21"></polyline>
              </svg>
              Photos
            </label>
            <input type="file" (change)="onFileSelect($event)" accept="image/*" multiple class="form-control">
            <div *ngIf="selectedFiles.length > 0" class="file-preview">
              <div *ngFor="let file of selectedFiles" class="file-item">
                <span>{{ file.name }}</span>
                <button type="button" (click)="removeFile(file)" class="remove-btn">Ã—</button>
              </div>
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-outline" (click)="resetForm()">Reset Form</button>
          <button type="submit" class="btn btn-primary"
            [disabled]="!newSpot.name || !newSpot.latitude || !newSpot.longitude">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
            </svg>
            Save Hidden Spot
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<app-footer></app-footer>